resource "aws_network_interface" "en1" {
  provider  = aws.us-east-1
  subnet_id = module.vpc-east.public_subnets[0]

  attachment {
    instance     = aws_instance.so.id
    device_index = 1
  }

}

#tfsec:ignore:aws-ec2-enforce-http-token-imds
#tfsec:ignore:aws-ec2-enable-at-rest-encryption
resource "aws_instance" "so" {
  provider                    = aws.us-east-1
  ami                         = "ami-0df15ac0295dc2b99"
  subnet_id                   = module.vpc-east.public_subnets[0]
  instance_type               = "t3a.2xlarge"
  key_name                    = aws_key_pair.w.key_name
  associate_public_ip_address = true
}

resource "aws_route53_record" "so" {
  provider = aws.us-east-1
  zone_id  = data.aws_route53_zone.iot.id
  name     = "onion.${local.dns_hosted_zone_name}"
  type     = "A"
  ttl      = "300"
  records  = [aws_instance.so.public_ip]
}

output "east-ssh_hostnames" {
  value = aws_route53_record.so.name
}
